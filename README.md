# üê± BarsikChat

–ó–∞—â–∏—â—ë–Ω–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —Å **E2E-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º (Signal Protocol)**, –∫–æ–º–Ω–∞—Ç–∞–º–∏, –ª–∏—á–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏, —Ñ–∞–π–ª–∞–º–∏, –Ω–æ–≤–æ—Å—Ç–Ω–æ–π –ª–µ–Ω—Ç–æ–π –∏ –ø–∞–Ω–µ–ª—å—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

![Java 21](https://img.shields.io/badge/Java-21-orange) ![Spring Boot 3.3.5](https://img.shields.io/badge/Spring%20Boot-3.3.5-green) ![React 19](https://img.shields.io/badge/React-19-blue) ![PostgreSQL 16](https://img.shields.io/badge/PostgreSQL-16-336791) ![Docker](https://img.shields.io/badge/Docker-Compose-2496ED)

> **214 backend-—Ç–µ—Å—Ç–æ–≤ ¬∑ 108 frontend-—Ç–µ—Å—Ç–æ–≤ ¬∑ 25 test-—Ñ–∞–π–ª–æ–≤**

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### E2E-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (Signal Protocol)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|---|---|
| –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π | **X3DH** (Extended Triple Diffie-Hellman) |
| –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π | **Double Ratchet** —Å PFS –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| –ö—Ä–∏–≤–∞—è | ECDH P-256 + ECDSA P-256 |
| –°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π —à–∏—Ñ—Ä | **AES-256-GCM** (AEAD, 12-byte IV) |
| KDF | HKDF-SHA-256 |
| –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ | AES-256-GCM (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª—é—á –Ω–∞ —Ñ–∞–π–ª) |
| –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π | IndexedDB (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å—Ç–æ—Ä–æ–Ω–∞) |
| –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è | Safety Number (24-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥) |

- –°–µ—Ä–≤–µ—Ä **–Ω–µ –≤–∏–¥–∏—Ç** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (`content: null`)
- E2E –≤–∫–ª—é—á–∞–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –≤–æ –≤—Å–µ—Ö –ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö
- 20 One-Time Pre-Keys —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–¥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- Retry-–ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª—é—á–µ–π (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫ —Å backoff)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è Signed Pre-Key –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏

### –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- TLS 1.2 / 1.3 (ECDHE + AES-GCM, no session tickets)
- HSTS (2 –≥–æ–¥–∞, preload-ready)
- Let's Encrypt —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º (certbot)
- OCSP Stapling

### –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

`Content-Security-Policy` ¬∑ `X-Content-Type-Options: nosniff` ¬∑ `X-Frame-Options: DENY` ¬∑ `Referrer-Policy` ¬∑ `Permissions-Policy` ¬∑ Server tokens –æ—Ç–∫–ª—é—á–µ–Ω—ã

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–≤—Ö–æ–¥ –ø–æ –ª–æ–≥–∏–Ω—É + –ø–∞—Ä–æ–ª—é
- –ü–∞—Ä–æ–ª–∏: **BCrypt** (cost 10)
- JWT (HMAC-SHA256, 24h TTL) —Å claim `role`
- –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å: `USER` / `ADMIN`
- Rate limiting: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω –Ω–∞ `/api/auth/*` (per-IP)
- WebSocket: JWT-–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- `/api/admin/**` –∑–∞—â–∏—â—ë–Ω `ROLE_ADMIN`

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üí¨ –ß–∞—Ç
- Real-time WebSocket-—á–∞—Ç
- üîê E2E-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤ –ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö (Signal Protocol)
- üè† –ö–æ–º–Ω–∞—Ç—ã: –æ–±—â–∏–π —á–∞—Ç, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ, –≥—Ä—É–ø–ø–æ–≤—ã–µ
- üîó –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –ø–æ —Å—Å—ã–ª–∫–µ
- ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚Ü©Ô∏è –û—Ç–≤–µ—Ç—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- @ –£–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚è∞ –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- üìä –°—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ / –ø—Ä–æ—á—Ç–µ–Ω–∏—è
- üü¢ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω
- ‚å®Ô∏è –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
- üîî Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ)

### üìé –§–∞–π–ª—ã –∏ –º–µ–¥–∏–∞
- –§–∞–π–ª—ã –¥–æ 100 –ú–ë (—Å E2E-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º)
- üòä Emoji Picker (160 —ç–º–æ–¥–∑–∏)

### üì∞ –ù–æ–≤–æ—Å—Ç–Ω–∞—è –ª–µ–Ω—Ç–∞
- –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –Ω–æ–≤–æ—Å—Ç—è–º

### ‚úÖ –ó–∞–¥–∞—á–∏
- –ö–∞–Ω–±–∞–Ω-–¥–æ—Å–∫–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö (—Å–æ–∑–¥–∞–Ω–Ω—ã–µ, –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ)

### üõ°Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–Ω–ª–∞–π–Ω (real-time WebSocket)
- –í—Å–µ–≥–æ —á–∞—Ç–æ–≤ (–ª–∏—á–Ω—ã–µ + –≥—Ä—É–ø–ø–æ–≤—ã–µ)
- –ê–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤ –∑–∞ 24 —á–∞—Å–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤ (1-1)
- –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

### üì± –î–∏–∑–∞–π–Ω
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–º–æ–±–∏–ª—å–Ω—ã–µ + –¥–µ—Å–∫—Ç–æ–ø)
- –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π / –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îú‚îÄ‚îÄ backend/                     # Spring Boot 3.3.5 (Java 21)
‚îÇ   ‚îú‚îÄ‚îÄ controller/              # 9 –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ (REST + WebSocket)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminController          # GET /api/admin/stats
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthController           # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –ª–æ–≥–∏–Ω
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatController           # REST-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —á–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatWebSocketHandler     # WebSocket real-time
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FileController           # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ KeyBundleController      # E2E –∫–ª—é—á–∏ (X3DH, 7 endpoints)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewsController           # –ù–æ–≤–æ—Å—Ç–Ω–∞—è –ª–µ–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoomController           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TaskController           # –ó–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ service/                 # 8 —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminService             # –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatService              # –°–æ–æ–±—â–µ–Ω–∏—è + –æ–Ω–ª–∞–π–Ω-—Ç—Ä–µ–∫–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ JwtService               # JWT —Å role claim
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ KeyBundleService         # E2E –∫–ª—é—á–∏ (X3DH)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewsService              # –ù–æ–≤–æ—Å—Ç–∏ + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoomService              # –ö–æ–º–Ω–∞—Ç—ã + —É—á–∞—Å—Ç–Ω–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SchedulerService         # –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TaskService              # –ó–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ entity/                  # 8 JPA-—Å—É—â–Ω–æ—Å—Ç–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserEntity               # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (username, password, role)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MessageEntity            # –°–æ–æ–±—â–µ–Ω–∏–µ (E2E-–ø–æ–ª—è, –æ—Ç–≤–µ—Ç—ã, —É–ø–æ–º–∏–Ω–∞–Ω–∏—è)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoomEntity               # –ö–æ–º–Ω–∞—Ç–∞ (GENERAL / PRIVATE / ROOM)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ KeyBundleEntity          # –ö–ª—é—á–µ–≤–æ–π –±–∞–Ω–¥–ª (X3DH)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OneTimePreKeyEntity      # –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –ø—Ä–µ-–∫–ª—é—á–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewsEntity               # –ù–æ–≤–æ—Å—Ç—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewsCommentEntity        # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –Ω–æ–≤–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TaskEntity               # –ó–∞–¥–∞—á–∞
‚îÇ   ‚îú‚îÄ‚îÄ config/                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SecurityConfig           # JWT-—Ñ–∏–ª—å—Ç—Ä, CORS, rate-limit, RBAC
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WebSocketConfig          # WebSocket handshake
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AdminUserInitializer     # –°–æ–∑–¥–∞–Ω–∏–µ admin-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ       ‚îú‚îÄ‚îÄ application.yml
‚îÇ       ‚îî‚îÄ‚îÄ db/migration/        # Flyway (V1‚ÄìV5)
‚îú‚îÄ‚îÄ frontend/                    # React 19.2 + Vite 7.3
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/          # 16 React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminPanel           # –î–∞—à–±–æ—Ä–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chat                 # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —á–∞—Ç–∞ + WebSocket
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatRoom             # –õ–µ–Ω—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π + –≤–≤–æ–¥
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar              # –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å + —Ç–∞–±—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login                # –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ / —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SecurityCodeModal    # –ö–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ E2E
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EmojiPicker          # –í—ã–±–æ—Ä —ç–º–æ–¥–∑–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NewsBoard / NewsCard # –ù–æ–≤–æ—Å—Ç–Ω–∞—è –ª–µ–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaskPanel            # –ö–∞–Ω–±–∞–Ω-–¥–æ—Å–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...                  # CreateRoom, JoinRoom, UserSearch, ...
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ crypto/              # 6 –º–æ–¥—É–ª–µ–π E2E-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ X3DH.js              # Key Agreement
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DoubleRatchet.js     # Forward Secrecy
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ E2EManager.js        # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª—é—á–µ–π)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ KeyManager.js        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏ (retry, sync)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CryptoStore.js       # IndexedDB —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ utils.js             # Web Crypto API —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile               # Multi-stage ‚Üí nginx:alpine
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf               # Reverse proxy (HTTP)
‚îÇ   ‚îî‚îÄ‚îÄ nginx-ssl.conf           # Reverse proxy (HTTPS + TLS)
‚îú‚îÄ‚îÄ docker-compose.yml           # Dev: PostgreSQL + Backend + Frontend
‚îú‚îÄ‚îÄ docker-compose.prod.yml      # Prod: + HTTPS + certbot
‚îî‚îÄ‚îÄ .env.example
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å: JWT_SECRET, DB_PASSWORD

# 2. –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose up -d --build

# 3. –û—Ç–∫—Ä—ã—Ç—å http://localhost
```

### Production (HTTPS)

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env (—É–∫–∞–∑–∞—Ç—å DOMAIN –∏ CERTBOT_EMAIL)
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å production-–æ–≤–µ—Ä–ª–µ–µ–º
docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build

# 3. –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
docker compose -f docker-compose.yml -f docker-compose.prod.yml run --rm certbot \
  certonly --webroot -w /var/www/certbot -d yourdomain.com

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å frontend –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
docker compose -f docker-compose.yml -f docker-compose.prod.yml restart frontend
```

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–±–µ–∑ Docker)

```bash
# PostgreSQL (—á–µ—Ä–µ–∑ Docker –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)
docker compose up -d postgres
# –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ë–î: barsikdb, user: barsik, password: barsik

# Backend (Java 21 required)
cd backend
mvn spring-boot:run
# ‚Üí http://localhost:9001

# Frontend
cd frontend
npm install
npm run dev
# ‚Üí http://localhost:5173 (proxy ‚Üí backend)
```

---

## üê≥ Docker-—Å–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | –û–±—Ä–∞–∑ | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ—Å—É—Ä—Å—ã |
|---|---|---|---|---|
| `postgres` | postgres:16-alpine | 5432 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) | PostgreSQL —Å healthcheck | 512M / 1 CPU |
| `backend` | eclipse-temurin:21-jre-alpine | 9001 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) | Spring Boot API + WebSocket | 768M / 2 CPU |
| `frontend` | nginx:alpine | 80, 443 | React SPA + reverse proxy | 128M / 0.5 CPU |
| `certbot` | certbot/certbot | ‚Äî | Let's Encrypt –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –¢–æ–ª—å–∫–æ prod |

```bash
# –õ–æ–≥–∏
docker compose logs -f backend

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
docker compose restart backend

# –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (—Å —É–¥–∞–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö)
docker compose down -v
```

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Backend

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `JWT_SECRET` | *(–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)* | –ö–ª—é—á –ø–æ–¥–ø–∏—Å–∏ JWT (–º–∏–Ω. 32 —Å–∏–º–≤–æ–ª–∞) |
| `JWT_EXPIRATION` | `86400000` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞, –º—Å (24—á) |
| `SERVER_PORT` | `9001` | –ü–æ—Ä—Ç backend |
| `DB_HOST` | `localhost` | –•–æ—Å—Ç PostgreSQL (`barsik-db` –≤ Docker) |
| `DB_PORT` | `5432` | –ü–æ—Ä—Ç PostgreSQL |
| `DB_NAME` | `barsikdb` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `DB_USER` | `barsik` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î |
| `DB_PASSWORD` | `barsik` | –ü–∞—Ä–æ–ª—å –ë–î |
| `MAX_FILE_SIZE` | `100MB` | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ |
| `UPLOAD_DIR` | `/app/uploads` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∑–æ–∫ |
| `CORS_ORIGINS` | `http://localhost:*` | –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ CORS-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ |
| `DDL_AUTO` | `validate` | Hibernate DDL (`update` / `validate`) |
| `HIKARI_MAX_POOL` | `10` | –ú–∞–∫—Å. —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –ø—É–ª–µ |
| `LOG_LEVEL` | `INFO` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |

### Production (HTTPS)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| `DOMAIN` | –î–æ–º–µ–Ω –¥–ª—è SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ |
| `CERTBOT_EMAIL` | Email –¥–ª—è Let's Encrypt |

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**Flyway** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:

| –ú–∏–≥—Ä–∞—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| `V1__init_schema.sql` | users, messages, rooms, room_members, news, tasks |
| `V2__create_key_bundles.sql` | key_bundles + one_time_pre_keys (E2E) |
| `V3__add_encryption_fields.sql` | –ü–æ–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –≤ messages (9 –∫–æ–ª–æ–Ω–æ–∫) |
| `V4__add_reply_and_mentions.sql` | –û—Ç–≤–µ—Ç—ã (reply_to) + —É–ø–æ–º–∏–Ω–∞–Ω–∏—è (mentions JSON) |
| `V5__add_user_role.sql` | –ö–æ–ª–æ–Ω–∫–∞ role –≤ app_users (USER / ADMIN) |

---

## üîå API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (`/api/auth`)
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| POST | `/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç token + username + role) |
| POST | `/login` | –í—Ö–æ–¥ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç token + username + role) |

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (`/api/admin`) üîí ADMIN
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| GET | `/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã |

### –ö–æ–º–Ω–∞—Ç—ã (`/api/rooms`)
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| GET | `/` | –ú–æ–∏ –∫–æ–º–Ω–∞—Ç—ã |
| POST | `/private/{username}` | –°–æ–∑–¥–∞—Ç—å / –ø–æ–ª—É—á–∏—Ç—å –ª–∏—á–Ω—ã–π —á–∞—Ç |
| POST | `/create` | –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É |
| POST | `/join/{roomId}` | –í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É |
| GET | `/{roomId}` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–Ω–∞—Ç–µ |
| GET | `/{roomId}/history` | –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π) |
| DELETE | `/{roomId}` | –£–¥–∞–ª–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É (–≤–ª–∞–¥–µ–ª–µ—Ü) |

### E2E –∫–ª—é—á–∏ ‚Äî Signal Protocol (`/api/keys`)
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| POST | `/bundle` | –ó–∞–≥—Ä—É–∑–∏—Ç—å Key Bundle |
| GET | `/bundle/{username}` | –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏ (–ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç 1 OTK) |
| POST | `/replenish` | –ü–æ–ø–æ–ª–Ω–∏—Ç—å One-Time Pre-Keys |
| GET | `/count` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è OTK |
| GET | `/identity/me` | –°–≤–æ–π identity key (–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è) |
| GET | `/identity/{username}` | Identity key –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| GET | `/has-bundle/{username}` | –ï—Å—Ç—å –ª–∏ E2E —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

### –ß–∞—Ç
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| WS | `/ws/chat?token=JWT` | WebSocket-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ |
| GET | `/api/chat/users` | –°–ø–∏—Å–æ–∫ –æ–Ω–ª–∞–π–Ω-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

### –§–∞–π–ª—ã
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| POST | `/api/upload` | –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª (–¥–æ 100 –ú–ë) |
| GET | `/api/uploads/{filename}` | –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª |

### –ù–æ–≤–æ—Å—Ç–∏ (`/api/news`)
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| GET | `/` | –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ |
| POST | `/` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å |
| POST | `/{id}/comments` | –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
| GET | `/{id}/comments` | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –Ω–æ–≤–æ—Å—Ç–∏ |

### –ó–∞–¥–∞—á–∏ (`/api/tasks`)
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| GET | `/` | –í—Å–µ –∑–∞–¥–∞—á–∏ |
| POST | `/` | –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É |
| PUT | `/{id}` | –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É |
| DELETE | `/{id}` | –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É |

### WebSocket-—Å–æ–æ–±—â–µ–Ω–∏—è (JSON)

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| `CHAT` | –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `EDIT` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `DELETE` | –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `SCHEDULED` | –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `TYPING` | –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ |
| `READ_RECEIPT` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–æ—á—Ç–µ–Ω–∏—è |
| `JOIN` / `LEAVE` | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ / –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ |
| `STATUS_UPDATE` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ |
| `REPLY_NOTIFICATION` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–≤–µ—Ç–µ |
| `MENTION_NOTIFICATION` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ |
| `TASK_CREATED` / `TASK_COMPLETED` / `TASK_OVERDUE` | –ó–∞–¥–∞—á–∏ |

---

## üß™ –¢–µ—Å—Ç—ã

### Backend ‚Äî 214 —Ç–µ—Å—Ç–æ–≤

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–ª–∞—Å—Å | –¢–µ—Å—Ç–æ–≤ |
|---|---|---|
| **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã** | AdminControllerTest | 2 |
| | AuthControllerTest | 10 |
| | ChatWebSocketHandlerTest | 21 |
| | FileControllerTest | 12 |
| | KeyBundleControllerTest | 14 |
| | NewsControllerTest | 5 |
| | RoomControllerTest | 17 |
| | TaskControllerTest | 13 |
| **–°–µ—Ä–≤–∏—Å—ã** | AdminServiceTest | 4 |
| | ChatServiceTest | 21 |
| | JwtServiceTest | 9 |
| | KeyBundleServiceTest | 21 |
| | NewsServiceTest | 7 |
| | RoomServiceTest | 13 |
| | SchedulerServiceTest | 6 |
| | TaskServiceTest | 9 |
| **E2E / –ü–æ–ª—è** | E2EFieldPropagationTest | 8 |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ** | IntegrationTest (H2) | 6 |
| | SecurityIntegrationTest (H2) | 16 |

```bash
cd backend && mvn test
```

### Frontend ‚Äî 108 —Ç–µ—Å—Ç–æ–≤

| –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| utils.test.js | 36 | –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —É—Ç–∏–ª–∏—Ç—ã (ECDH, ECDSA, AES-GCM, HKDF) |
| SecurityCodeDiagnostic.test.js | 30 | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–¥–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (A‚ÄìJ —Å—Ü–µ–Ω–∞—Ä–∏–∏) |
| SecurityCodeModal.test.jsx | 16 | UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ–¥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ |
| DoubleRatchet.test.js | 11 | Double Ratchet –ø—Ä–æ—Ç–æ–∫–æ–ª |
| E2ESecurityCode.test.js | 9 | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è Safety Number |
| X3DH.test.js | 6 | Extended Triple Diffie-Hellman |

```bash
cd frontend && npx vitest run
```

---

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

### Backend
- **Java 21** + **Spring Boot 3.3.5**
- Spring Security + JWT (HMAC-SHA256) + RBAC
- Spring WebSocket (TextWebSocketHandler)
- Spring Data JPA + Hibernate
- PostgreSQL 16 + Flyway (5 –º–∏–≥—Ä–∞—Ü–∏–π)
- BCrypt (password hashing)
- JJWT 0.11.5

### Frontend
- **React 19.2** + **Vite 7.3**
- **Vitest 4.0** + Testing Library
- Web Crypto API (ECDH, ECDSA, AES-GCM, HKDF, HMAC)
- IndexedDB (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π E2E)
- CSS (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω, —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞)

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Docker** + Docker Compose (4 —Å–µ—Ä–≤–∏—Å–∞)
- **nginx** (reverse proxy + TLS termination)
- **Let's Encrypt** (certbot, –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- Flyway (–º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î)
- GitHub (CI-ready)

---

## üìê –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Telegram

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | BarsikChat | Telegram |
|---|---|---|
| –ü—Ä–æ—Ç–æ–∫–æ–ª E2E | ‚úÖ Signal (X3DH + Double Ratchet) | ‚ö†Ô∏è MTProto 2.0 (–∫–∞—Å—Ç–æ–º–Ω—ã–π) |
| E2E –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | ‚úÖ –ê–≤—Ç–æ –≤ –ª–∏—á–Ω—ã—Ö | ‚ùå –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ |
| Forward Secrecy | ‚úÖ Per-message | ‚ö†Ô∏è Per-session |
| –®–∏—Ñ—Ä | ‚úÖ AES-256-GCM (AEAD) | ‚ö†Ô∏è AES-256-IGE |
| TLS | ‚úÖ 1.2/1.3 —Å—Ç–∞–Ω–¥–∞—Ä—Ç | –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç |
| –°–µ—Ä–≤–µ—Ä –≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è | ‚ùå –ù–µ—Ç | ‚úÖ Cloud Chats |
| –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª—é—á–µ–π | ‚úÖ Safety Number | ‚úÖ Fingerprint |
| –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å | ‚úÖ USER / ADMIN | ‚úÖ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è |

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
